0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100  1) from collections import defaultdict
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100  2) import mock
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100  3) from searx.engines import yacy
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100  4) from searx.testing import SearxTestCase
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100  5) 
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100  6) 
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100  7) class TestYacyEngine(SearxTestCase):
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100  8) 
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100  9)     def test_request(self):
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 10)         query = 'test_query'
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 11)         dicto = defaultdict(dict)
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 12)         dicto['pageno'] = 1
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 13)         dicto['language'] = 'fr_FR'
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 14)         params = yacy.request(query, dicto)
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 15)         self.assertIn('url', params)
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 16)         self.assertIn(query, params['url'])
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 17)         self.assertIn('localhost', params['url'])
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 18)         self.assertIn('fr', params['url'])
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 19) 
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 20)     def test_response(self):
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 21)         self.assertRaises(AttributeError, yacy.response, None)
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 22)         self.assertRaises(AttributeError, yacy.response, [])
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 23)         self.assertRaises(AttributeError, yacy.response, '')
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 24)         self.assertRaises(AttributeError, yacy.response, '[]')
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 25) 
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 26)         response = mock.Mock(text='{}')
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 27)         self.assertEqual(yacy.response(response), [])
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 28) 
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 29)         response = mock.Mock(text='{"data": []}')
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 30)         self.assertEqual(yacy.response(response), [])
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 31) 
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 32)         json = """
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 33)         {
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 34)           "channels": [
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 35)             {
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 36)               "title": "YaCy P2P-Search for test",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 37)               "description": "Search for test",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 38)               "link": "http://search.yacy.de:7001/yacysearch.html?query=test&amp;resource=global&amp;contentdom=0",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 39)               "image": {
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 40)                 "url": "http://search.yacy.de:7001/env/grafics/yacy.png",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 41)                 "title": "Search for test",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 42)                 "link": "http://search.yacy.de:7001/yacysearch.html?query=test&amp;resource=global&amp;contentdom=0"
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 43)               },
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 44)               "totalResults": "249",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 45)               "startIndex": "0",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 46)               "itemsPerPage": "5",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 47)               "searchTerms": "test",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 48)               "items": [
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 49)                 {
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 50)                   "title": "This is the title",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 51)                   "link": "http://this.is.the.url",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 52)                   "code": "",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 53)                   "description": "This should be the content",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 54)                   "pubDate": "Sat, 08 Jun 2013 02:00:00 +0200",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 55)                   "size": "44213",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 56)                   "sizename": "43 kbyte",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 57)                   "guid": "lzh_1T_5FP-A",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 58)                   "faviconCode": "XTS4uQ_5FP-A",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 59)                   "host": "www.gamestar.de",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 60)                   "path": "/spiele/city-of-heroes-freedom/47019.html",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 61)                   "file": "47019.html",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 62)                   "urlhash": "lzh_1T_5FP-A",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 63)                   "ranking": "0.20106804"
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 64)                 },
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 65)                 {
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 66)                   "title": "This is the title2",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 67)                   "icon": "/ViewImage.png?maxwidth=96&amp;maxheight=96&amp;code=7EbAbW6BpPOA",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 68)                   "image": "http://image.url/image.png",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 69)                   "cache": "/ViewImage.png?quadratic=&amp;url=http://golem.ivwbox.de/cgi-bin/ivw/CP/G_INET?d=14071378",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 70)                   "url": "http://this.is.the.url",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 71)                   "urlhash": "7EbAbW6BpPOA",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 72)                   "host": "www.golem.de",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 73)                   "width": "-1",
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 74)                   "height": "-1"
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 75)                 }
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 76)               ]
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 77)             }
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 78)           ]
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 79)         }
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 80)         """
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 81)         response = mock.Mock(text=json)
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 82)         results = yacy.response(response)
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 83)         self.assertEqual(type(results), list)
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 84)         self.assertEqual(len(results), 2)
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 85)         self.assertEqual(results[0]['title'], 'This is the title')
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 86)         self.assertEqual(results[0]['url'], 'http://this.is.the.url')
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 87)         self.assertEqual(results[0]['content'], 'This should be the content')
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 88)         self.assertEqual(results[1]['img_src'], 'http://image.url/image.png')
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 89)         self.assertEqual(results[1]['content'], '')
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 90)         self.assertEqual(results[1]['url'], 'http://this.is.the.url')
0a537d3b searx/tests/engines/test_yacy.py (Cqoicebordel 2015-02-09 16:55:01 +0100 91)         self.assertEqual(results[1]['title'], 'This is the title2')
