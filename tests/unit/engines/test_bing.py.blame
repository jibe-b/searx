525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100   1) from collections import defaultdict
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100   2) import mock
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100   3) from searx.engines import bing
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100   4) from searx.testing import SearxTestCase
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100   5) 
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100   6) 
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100   7) class TestBingEngine(SearxTestCase):
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100   8) 
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100   9)     def test_request(self):
52e615de tests/unit/engines/test_bing.py  (Adam Tauber  2016-11-30 18:43:03 +0100  10)         query = u'test_query'
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  11)         dicto = defaultdict(dict)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  12)         dicto['pageno'] = 0
4d177039 tests/unit/engines/test_bing.py  (marc         2017-07-20 15:47:20 -0500  13)         dicto['language'] = 'fr-FR'
52e615de tests/unit/engines/test_bing.py  (Adam Tauber  2016-11-30 18:43:03 +0100  14)         params = bing.request(query.encode('utf-8'), dicto)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  15)         self.assertTrue('url' in params)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  16)         self.assertTrue(query in params['url'])
16ff8d06 tests/unit/engines/test_bing.py  (Adam Tauber  2016-11-07 22:30:20 +0100  17)         self.assertTrue('language%3AFR' in params['url'])
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  18)         self.assertTrue('bing.com' in params['url'])
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  19) 
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  20)     def test_response(self):
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  21)         self.assertRaises(AttributeError, bing.response, None)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  22)         self.assertRaises(AttributeError, bing.response, [])
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  23)         self.assertRaises(AttributeError, bing.response, '')
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  24)         self.assertRaises(AttributeError, bing.response, '[]')
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  25) 
604f32f6 searx/tests/engines/test_bing.py (Adam Tauber  2015-08-28 14:51:32 +0200  26)         response = mock.Mock(text='<html></html>')
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  27)         self.assertEqual(bing.response(response), [])
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  28) 
604f32f6 searx/tests/engines/test_bing.py (Adam Tauber  2015-08-28 14:51:32 +0200  29)         response = mock.Mock(text='<html></html>')
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  30)         self.assertEqual(bing.response(response), [])
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  31) 
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  32)         html = """
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  33)         <div class="sa_cc" u="0|5109|4755453613245655|UAGjXgIrPH5yh-o5oNHRx_3Zta87f_QO">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  34)             <div Class="sa_mc">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  35)                 <div class="sb_tlst">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  36)                     <h3>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  37)                         <a href="http://this.should.be.the.link/" h="ID=SERP,5124.1">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  38)                         <strong>This</strong> should be the title</a>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  39)                     </h3>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  40)                 </div>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  41)                 <div class="sb_meta"><cite><strong>this</strong>.meta.com</cite>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  42)                     <span class="c_tlbxTrg">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  43)                         <span class="c_tlbxH" H="BASE:CACHEDPAGEDEFAULT" K="SERP,5125.1">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  44)                         </span>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  45)                     </span>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  46)                 </div>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  47)                 <p><strong>This</strong> should be the content.</p>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  48)             </div>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  49)         </div>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  50)         """
604f32f6 searx/tests/engines/test_bing.py (Adam Tauber  2015-08-28 14:51:32 +0200  51)         response = mock.Mock(text=html)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  52)         results = bing.response(response)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  53)         self.assertEqual(type(results), list)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  54)         self.assertEqual(len(results), 1)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  55)         self.assertEqual(results[0]['title'], 'This should be the title')
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  56)         self.assertEqual(results[0]['url'], 'http://this.should.be.the.link/')
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  57)         self.assertEqual(results[0]['content'], 'This should be the content.')
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  58) 
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  59)         html = """
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  60)         <li class="b_algo" u="0|5109|4755453613245655|UAGjXgIrPH5yh-o5oNHRx_3Zta87f_QO">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  61)             <div Class="sa_mc">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  62)                 <div class="sb_tlst">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  63)                     <h2>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  64)                         <a href="http://this.should.be.the.link/" h="ID=SERP,5124.1">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  65)                         <strong>This</strong> should be the title</a>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  66)                     </h2>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  67)                 </div>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  68)                 <div class="sb_meta"><cite><strong>this</strong>.meta.com</cite>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  69)                     <span class="c_tlbxTrg">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  70)                         <span class="c_tlbxH" H="BASE:CACHEDPAGEDEFAULT" K="SERP,5125.1">
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  71)                         </span>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  72)                     </span>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  73)                 </div>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  74)                 <p><strong>This</strong> should be the content.</p>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  75)             </div>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  76)         </li>
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  77)         """
604f32f6 searx/tests/engines/test_bing.py (Adam Tauber  2015-08-28 14:51:32 +0200  78)         response = mock.Mock(text=html)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  79)         results = bing.response(response)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  80)         self.assertEqual(type(results), list)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  81)         self.assertEqual(len(results), 1)
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  82)         self.assertEqual(results[0]['title'], 'This should be the title')
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  83)         self.assertEqual(results[0]['url'], 'http://this.should.be.the.link/')
525af2a0 searx/tests/engines/test_bing.py (Cqoicebordel 2015-01-25 20:14:37 +0100  84)         self.assertEqual(results[0]['content'], 'This should be the content.')
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  85) 
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  86)     def test_fetch_supported_languages(self):
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  87)         html = """<html></html>"""
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  88)         response = mock.Mock(text=html)
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  89)         results = bing._fetch_supported_languages(response)
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  90)         self.assertEqual(type(results), list)
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  91)         self.assertEqual(len(results), 0)
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  92) 
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  93)         html = """
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  94)         <html>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  95)             <body>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  96)                 <form>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  97)                     <div id="limit-languages">
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  98)                         <div>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600  99)                             <div><input id="es" value="es"></input></div>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 100)                         </div>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 101)                         <div>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 102)                             <div><input id="pt_BR" value="pt_BR"></input></div>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 103)                             <div><input id="pt_PT" value="pt_PT"></input></div>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 104)                         </div>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 105)                     </div>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 106)                 </form>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 107)             </body>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 108)         </html>
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 109)         """
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 110)         response = mock.Mock(text=html)
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 111)         languages = bing._fetch_supported_languages(response)
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 112)         self.assertEqual(type(languages), list)
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 113)         self.assertEqual(len(languages), 3)
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 114)         self.assertIn('es', languages)
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 115)         self.assertIn('pt-BR', languages)
af35eee1 tests/unit/engines/test_bing.py  (marc         2016-12-15 00:34:43 -0600 116)         self.assertIn('pt-PT', languages)
