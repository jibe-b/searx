ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100   1) # -*- coding: utf-8 -*-
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100   2) from collections import defaultdict
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100   3) from datetime import datetime
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100   4) import mock
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100   5) from searx.engines import yahoo_news
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100   6) from searx.testing import SearxTestCase
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100   7) 
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100   8) 
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100   9) class TestYahooNewsEngine(SearxTestCase):
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  10) 
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  11)     def test_request(self):
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  12)         query = 'test_query'
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  13)         dicto = defaultdict(dict)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  14)         dicto['pageno'] = 1
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  15)         dicto['language'] = 'fr_FR'
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  16)         params = yahoo_news.request(query, dicto)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  17)         self.assertIn('url', params)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  18)         self.assertIn(query, params['url'])
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  19)         self.assertIn('news.search.yahoo.com', params['url'])
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  20)         self.assertIn('fr', params['url'])
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  21)         self.assertIn('cookies', params)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  22)         self.assertIn('sB', params['cookies'])
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  23)         self.assertIn('fr', params['cookies']['sB'])
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  24) 
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  25)     def test_sanitize_url(self):
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  26)         url = "test.url"
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  27)         self.assertEqual(url, yahoo_news.sanitize_url(url))
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  28) 
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  29)         url = "www.yahoo.com/;_ylt=test"
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  30)         self.assertEqual("www.yahoo.com/", yahoo_news.sanitize_url(url))
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  31) 
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  32)     def test_response(self):
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  33)         self.assertRaises(AttributeError, yahoo_news.response, None)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  34)         self.assertRaises(AttributeError, yahoo_news.response, [])
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  35)         self.assertRaises(AttributeError, yahoo_news.response, '')
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  36)         self.assertRaises(AttributeError, yahoo_news.response, '[]')
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  37) 
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  38)         response = mock.Mock(text='<html></html>')
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  39)         self.assertEqual(yahoo_news.response(response), [])
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  40) 
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  41)         html = """
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  42)         <ol class=" reg searchCenterMiddle">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  43)             <li class="first">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  44)                 <div class="compTitle">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  45)                     <h3>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  46)                         <a class="yschttl spt" href="http://this.is.the.url" target="_blank">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  47)                            This is
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  48)                            the <b>title</b>...
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  49)                         </a>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  50)                     </h3>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  51)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  52)                 <div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  53)                     <span class="cite">Business via Yahoo!</span>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  54)                     <span class="tri fc-2nd ml-10">May 01 10:00 AM</span>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  55)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  56)                 <div class="compText">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  57)                    This is the content
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  58)                </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  59)             </li>
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  60)             <li class="first">
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  61)                 <div class="compTitle">
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  62)                     <h3>
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  63)                         <a class="yschttl spt" target="_blank">
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  64)                         </a>
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  65)                     </h3>
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  66)                 </div>
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  67)                 <div class="compText">
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  68)                </div>
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  69)             </li>
0a1a3e73 searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-06-12 19:54:03 +0200  70)         </ol>
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  71)         """
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  72)         response = mock.Mock(text=html)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  73)         results = yahoo_news.response(response)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  74)         self.assertEqual(type(results), list)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  75)         self.assertEqual(len(results), 1)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  76)         self.assertEqual(results[0]['title'], 'This is the title...')
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  77)         self.assertEqual(results[0]['url'], 'http://this.is.the.url/')
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  78)         self.assertEqual(results[0]['content'], 'This is the content')
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  79) 
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100  80)         html = """
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  81)         <ol class=" reg searchCenterMiddle">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  82)             <li class="first">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  83)                 <div class="compTitle">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  84)                     <h3>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  85)                         <a class="yschttl spt" href="http://this.is.the.url" target="_blank">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  86)                             This is
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  87)                             the <b>title</b>...
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  88)                         </a>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  89)                     </h3>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  90)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  91)                 <div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  92)                     <span class="cite">Business via Yahoo!</span>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  93)                     <span class="tri fc-2nd ml-10">2 hours, 22 minutes ago</span>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  94)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  95)                 <div class="compText">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  96)                     This is the content
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  97)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  98)             </li>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200  99)             <li>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 100)                 <div class="compTitle">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 101)                     <h3>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 102)                         <a class="yschttl spt" href="http://this.is.the.url" target="_blank">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 103)                             This is
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 104)                             the <b>title</b>...
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 105)                         </a>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 106)                     </h3>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 107)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 108)                 <div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 109)                     <span class="cite">Business via Yahoo!</span>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 110)                     <span class="tri fc-2nd ml-10">22 minutes ago</span>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 111)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 112)                 <div class="compText">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 113)                     This is the content
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 114)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 115)             </li>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 116)             <li>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 117)                 <div class="compTitle">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 118)                     <h3>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 119)                         <a class="yschttl spt" href="http://this.is.the.url" target="_blank">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 120)                             This is
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 121)                             the <b>title</b>...
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 122)                         </a>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 123)                     </h3>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 124)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 125)                 <div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 126)                     <span class="cite">Business via Yahoo!</span>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 127)                     <span class="tri fc-2nd ml-10">Feb 03 09:45AM 1900</span>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 128)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 129)                 <div class="compText">
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 130)                     This is the content
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 131)                 </div>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 132)             </li>
44ed4424 searx/tests/engines/test_yahoo_news.py (Alexandre Flament 2015-05-02 21:08:56 +0200 133)         </ol>
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100 134)         """
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100 135)         response = mock.Mock(text=html)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100 136)         results = yahoo_news.response(response)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100 137)         self.assertEqual(type(results), list)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100 138)         self.assertEqual(len(results), 3)
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100 139)         self.assertEqual(results[0]['title'], 'This is the title...')
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100 140)         self.assertEqual(results[0]['url'], 'http://this.is.the.url/')
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100 141)         self.assertEqual(results[0]['content'], 'This is the content')
ff2ad57a searx/tests/engines/test_yahoo_news.py (Cqoicebordel      2015-02-04 20:07:26 +0100 142)         self.assertEqual(results[2]['publishedDate'].year, datetime.now().year)
